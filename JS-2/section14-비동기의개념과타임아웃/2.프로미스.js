// ì—°ì†ì ìœ¼ë¡œ ë¹„ë™ê¸° ì½”ë“œë¥¼ ì¨ì•¼ í•˜ëŠ” ê²½ìš°

// ì½œë°± í•¨ìˆ˜ ì•ˆì— ë˜ ë‹¤ë¥¸ ì½œë°± í•¨ìˆ˜ë¥¼ ë„£ì–´ì•¼ í•˜ëŠ” ìƒí™© ë°œìƒ - ì½œë°± ì§€ì˜¥
// íšŸìˆ˜ê°€ ë§Žì„ìˆ˜ë¡ ê°€ë…ì„±ë„ ë‚®ì•„ì§€ê³  ì§ê´€ì„±ì´ ë–¨ì–´ì§ ì‹¤ì „ì—ì„œëŠ” ë”ë”ìš± ë³µìž¡í•˜ê³  ë‚œí•´í•´ì§
relayRun('ì² ìˆ˜', 0, start1 => {
  relayRun('ì˜í¬', start1, start2 => {
    relayRun('ëŒì¤€', start2, start3 => {
      relayRun('ì •ì•„', start3, start4 => {
        relayRun('ê¸¸ëˆ', start4, null, 'ì•„ì•„, ì•„ê¹ìŠµë‹ˆë‹¤...');
      }, 'ì •ì•„ì—ê²Œ ë¬´ë¦¬ì˜€ë‚˜ë³´ë„¤ìš”.');
    }, 'ëŒì¤€ì´ ë¶„ë°œí•´ë¼.');
  }, 'ì˜í¬ê°€ ì™„ì£¼í•˜ì§€ ëª»í–ˆë„¤ìš”.');
}, 'ì² ìˆ˜ë¶€í„° ê´‘íƒˆìž…ë‹ˆë‹¤. ã… ã… ');

//í”„ë¡œë¯¸ìŠ¤ promise
// (ë³´í†µ ì‹œê°„ì´ ê±¸ë¦¬ëŠ”) ì–´ë–¤ ê³¼ì • ì´í›„ ì£¼ì–´ì§„ ë™ìž‘ì„ ì‹¤í–‰í•  ê²ƒì´ëž€ ì•½ì†
// ì¤‘ì²©ëœ ë¹„ë™ê¸° ì½”ë“œë¥¼ ì§ê´€ì ì´ê³  ì—°ì†ì ì¸ ì½”ë“œë¡œ ìž‘ì„±í•  ìˆ˜ ìžˆë„ë¡ í•¨


//ìƒì„±ìž Promise - ðŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°
const borrow =20;

const payWith10perc =new Promise((resolve, reject)=>{
  resolve(borrow*1.1);
});

payWith10perc.then(result=>{
  console.log(result +'ë§Œì›');
});

// ìƒˆë¡œìš´ ì•½ì†ì„ í•˜ëŠ” ì½”ë“œ
// ì¸ìžë¡œ ë°›ëŠ” ì½œë°±í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ì¸ìž resolve(ì´ë¦„ì€ ê´€ë¡€) - ì•½ì† ì´í–‰ ì„±ê³µì‹œ, ë°˜í™˜í•  ê°’ ë„£ì–´ ì‹¤í–‰
// í”„ë¡œë¯¸ìŠ¤ ì¸ìŠ¤í„´ìŠ¤(ë§Œë“¤ì–´ì§„ ì•½ì†) ì˜ then ë©”ì„œë“œ

// resolveë¥¼ í†µí•´(ì•½ì†ëŒ€ë¡œ) ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ì¸ìžë¡œ í•˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ë„£ìŒ
// â­ ë˜ ë‹¤ë¥¸ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜ - ì²´ì´ë‹ ê°€ëŠ¥

const borrow=20;
const payWith10perc = new Promise((resolve,reject)=>{
  //ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ì½”ë“œ ì‚¬ìš©
  setTimeout(()=>{
    resolve(borrow*1.1);
  },1000);
});

//í”„ë¡œë¯¸ìŠ¤ê°€ ìƒì„±ë˜ëŠ” ìˆœê°„ë¶€í„° ì‹œê°„ ê²½ê³¼ 
payWith10perc.then(result =>{
  console.log(result + 'ë§Œì›');
})
// ì¼ë°˜ì ìœ¼ë¡œ ë‚´ë¶€ì— ë¹„ë™ê¸° ì½”ë“œë¥¼ ì‚¬ìš©
// ì‹œê°„ì´ ì†Œëª¨ë˜ëŠ” ë¹„ë™ê¸° ê³¼ì • í›„ ~ë¥¼ ë°˜í™˜í•˜ê² ë‹¤ëŠ” ì•½ì†


const borrow=20;
const payWith10perc = new Promise((resolve, reject) => {
  //ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ì½”ë“œ ì‚¬ìš©
  setTimeout(() => {
    if(Math.random()<0.3){
      reject('ëª»ê°šìŒ');
    }
    resolve(borrow * 1.1);
  }, 1000);
});

//í”„ë¡œë¯¸ìŠ¤ê°€ ìƒì„±ë˜ëŠ” ìˆœê°„ë¶€í„° ì‹œê°„ ê²½ê³¼ 
payWith10perc.then(result => {
  console.log(result + 'ë§Œì›');
})
.catch(msg=>{
  console.error(msg);
})
.finally(()=>{
  console.log('ê¸°í•œ ì¢…ë£Œ');
})

//ìƒì„±ìž Promise
// ì¸ìžë¡œ ë°›ëŠ” ì½œë°±í•¨ìˆ˜ì˜ ë‘ ë²ˆì§¸ ì¸ìž reject(ì´ë¦„ì€ ê´€ë¡€) - ì•½ì† ì´í–‰ ì‹¤íŒ¨ì‹œ, ë°˜í™˜í•  ê°’ ë„£ì–´ ì‹¤í–‰
// rejectê°€ ì‹¤í–‰ë˜ë©´ resolveëŠ” ë¬´ì‹œë¨

// í”„ë¡œë¯¸ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì˜
// catch ë©”ì„œë“œ: rejectë¥¼ í†µí•´(ì‹¤íŒ¨ë¡œ ì¸í•´) ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ì¸ìžë¡œ í•˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ë„£ìŒ
// finally ë©”ì„œë“œ: ì„±ê³µí•˜ë“  ì‹¤íŒ¨í•˜ë“  ì‹¤í–‰í•  ì½œë°± í•¨ìˆ˜ - í•„ìš”í•  ë•Œë§Œ ì‚¬ìš©
// thenê³¼ ë”ë¶ˆì–´ ë©”ì„œë“œ ì²´ì´ë‹ìœ¼ë¡œ ì‚¬ìš©

// ë¹Œë¦° ê¸ˆì•¡ìœ¼ë¡œ ì•½ì†ì„ í•˜ëŠ” í•¨ìˆ˜
function moneyLend(borrow) {
  return new Promise((resolve, reject) => {
    console.log(`ì±„ë¬´ ${borrow}ë§Œì›`);

    setTimeout(() => {
      if (Math.random() < 0.1) {
        reject('ì±„ë¬´ìž íŒŒì‚°');
      }

      resolve(borrow * 1.1);
    }, 1000);
  });
}
moneyLend(20)
  .then(result => moneyLend(result))
  .then(moneyLend) // ì¸ìžë¥¼ í•˜ë‚˜ ë°›ì•„ì„œ ê·¸ëŒ€ë¡œ ì“°ë¯€ë¡œ
  .then(moneyLend) // ì´ë ‡ê²Œ ì¤„ì—¬ë²„ë¦´ ìˆ˜ ìžˆìŒ
  .then(moneyLend)
  .then(result => {
    console.log(`ðŸ’° ë°˜ë‚© ${result}ë§Œì›`);
  })
  .catch(msg => {
    console.error(msg);
  })
  .finally(() => {
    console.log('- - ëŒ€ê¸ˆì—… ì¢…ë£Œ - -');
  });
